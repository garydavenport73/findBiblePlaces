window.FastCommentsUI=function(n,e){return function(n,e,t){if(null===n)return console.warn("FastComments: targetElement does not exist!");var o=window.location,a=o.hash;function i(n,e,t){n.setAttribute(e,t)}function s(n){JSON.stringify(n)!==JSON.stringify(window.fcLastUserObj)&&(window.fcUIInstances&&window.fcUIInstances.forEach((function(e){if(e&&e.instance)try{e.instance.updateUser(n)}catch(n){console.error(n)}})),window.fcLastUserObj=n)}function r(n){return n.includes("#fast-comments-jt=")&&(n=n.replace(a,"")),n}null!==e.urlId&&void 0!==e.urlId&&"number"==typeof e.urlId&&(e.urlId=""+e.urlId);const c=e.onAuthenticationChange;e.onAuthenticationChange=function(n,e){("logout"===n||"user-set"===n||"session-id-set"===n)&&s(e),c&&c(n,e)};let d=!0;const l=e.onCommentsRendered;e.onCommentsRendered=function(){d&&(window.fcLastUserObj&&u.instance&&u.instance.updateUser(window.fcLastUserObj),d=!0,l&&l())};const u={targetElement:n,config:e};window.fcUIInstances?window.fcUIInstances.push(u):window.fcUIInstances=[u];var g={};for(var m in e)"function"==typeof e[m]&&(g[m]=e[m],delete e[m]);e.sso&&(e.sso.loginCallback&&(g.loginCallback=e.sso.loginCallback,e.sso.loginCallback=!0),e.sso.logoutCallback&&(g.logoutCallback=e.sso.logoutCallback,e.sso.logoutCallback=!0));for(var p=(e=JSON.parse(JSON.stringify(e))).apiHost?e.apiHost:"https://fastcomments.com",f=document.createElement("iframe"),w=0,I=n;void 0===e.hasDarkBackground&&I&&I.parentNode;){var h=null;try{h=window.getComputedStyle(I,"background")}catch(n){}if(h&&h.backgroundColor){var y=h.backgroundColor;if("rgba(0, 0, 0, 0)"!==y&&"transparent"!==y){var C=y.substring(y.indexOf("(")+1,y.length-1).split(","),b=isNaN(C[3])?1:parseFloat(C[3]);if(C=C.map((n,e)=>parseInt(n,10)),b<1&&(C[0]=(1-b)*C[0]+b*C[0],C[1]=(1-b)*C[1]+b*C[1],C[2]=(1-b)*C[2]+b*C[2]),.299*C[0]+.587*C[1]+.114*C[2]<100&&(e.hasDarkBackground=!0),1===b)break}}I=I.parentNode}if(a&&a.indexOf("#fast-comments-jt=")>-1){var k=a.substring("#fast-comments-jt=".length,a.length);k&&(e.jumpToId=k)}for(var m in e.urlId=r(e.urlId?e.urlId:o.href),e.url=r(e.url?e.url:o.href),e.pageTitle=document.title,e.instanceId=Math.random()+"."+Date.now(),e){var v=e[m];void 0===v?delete e[m]:e[m]="number"==typeof v?v:"object"!=typeof v?encodeURIComponent(v):v}function U(n){(n>w||Math.abs(n-w)>100||0===n)&&(w=n,f.height=n)}function O(n){if(n.data&&n.origin===p)try{var t=JSON.parse(n.data);if(t.instanceId!==e.instanceId)return;"update-height"===t.type?U(t.height):"update-comment-count"===t.type?g.commentCountUpdated&&g.commentCountUpdated(t.count):"scroll-to-position"===t.type&&t.y>0?window.scrollTo({top:f.getBoundingClientRect().y+window.scrollY+t.y}):"redirect"===t.type?t.isNewWindow?window.open(t.url):window.location=t.url:"update-config"===t.type?u.finalConfig=t.config:"login"===t.type?g.loginCallback&&g.loginCallback(e.instanceId):"logout"===t.type?g.logoutCallback&&g.logoutCallback(e.instanceId):"reply-success"===t.type?g.onReplySuccess&&g.onReplySuccess(t.comment):"vote-success"===t.type?g.onVoteSuccess&&g.onVoteSuccess(t.comment,t.voteId,t.direction,t.status):"on-init"===t.type?g.onInit&&g.onInit():"on-render"===t.type?g.onRender&&g.onRender():"on-image-clicked"===t.type?g.onImageClicked&&g.onImageClicked(t.src):"on-authentication-change"===t.type?g.onAuthenticationChange&&g.onAuthenticationChange(t.changeType,t.data):"on-comments-rendered"===t.type&&g.onCommentsRendered&&g.onCommentsRendered(t.comments)}catch(t){e.apiHost&&console.error(n,t)}}function N(){n.innerHTML="",window.removeEventListener("message",O,!1);const e=window.fcUIInstances.indexOf(u);e>-1&&window.fcUIInstances.splice(e,1)}u.config=e,/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator&&navigator.userAgent)&&(u.config.startingPage=-1,e.isCrawler=!0),f.src=p+"/embed?config="+encodeURIComponent(JSON.stringify(e))+"&wId="+t,i(f,"horizontalscrolling","no"),i(f,"verticalscrolling","no"),i(f,"allowtransparency","true"),i(f,"frameborder","0"),i(f,"scrolling","no"),i(f,"title","FastComments"),i(f,"width","100%"),i(f,"style","width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important;"),n.append(f),u.requested=!0,"true"===e.readonly&&U(0),window.addEventListener("message",O,!1);const S={destroy:N,update:function(e){N(),window.FastCommentsUI(n,e)},updateUser:function(n){f&&f.contentWindow&&f.contentWindow.postMessage(JSON.stringify({type:"update-user",user:n,instanceId:e.instanceId}),"*")}};return u.instance=S,S}(n,e,"comment-ui")};